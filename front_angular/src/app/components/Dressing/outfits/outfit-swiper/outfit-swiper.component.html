<div class="swiper-container" *ngIf="currentItem || loadingAI">
  <!-- AI Loading Screen -->
  <div class="ai-loading-overlay" *ngIf="loadingAI">
    <div class="ai-loading-content">
      <div class="ai-loading-animation">
        <mat-icon class="brain-icon">psychology</mat-icon>
        <div class="ai-pulse"></div>
      </div>
      <mat-spinner diameter="50"></mat-spinner>
      <p class="ai-message">{{ loadingMessage }}</p>
      <div class="ai-thinking-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <!-- Game Stats -->
  <div class="game-stats" *ngIf="!loadingAI">
    <div class="streak-counter">
      <div class="streak-progress">
        <div class="streak-bar" [style.width.%]="(likedItems.size / 4) * 100"></div>
      </div>
      <span>Streak: {{ likedItems.size }}/4</span>
    </div>
  </div>

  <!-- Close Button -->
  <button mat-icon-button class="close-button" (click)="closeSwiper()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Next Card -->
  <div class="next-card" *ngIf="nextItem">
    <mat-card>
      <img [src]="nextItem.imageUrl || 'assets/images/placeholder.jpg'" alt="Next item">
    </mat-card>
  </div>

  <!-- Current Card -->
  <div class="current-card"
       [style.transform]="'translate(' + currentPosition.x + 'px, ' + currentPosition.y + 'px) rotate(' + rotation + 'deg)'"
       (panstart)="onPanStart($event)"
       (panmove)="onPanMove($event)"
       (panend)="onPanEnd($event)"
       *ngIf="currentItem && !loadingAI">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ currentItem.itemName }}</mat-card-title>
        <mat-card-subtitle>
          {{ currentItem.category }} â€¢ {{ currentItem.color }}
        </mat-card-subtitle>
      </mat-card-header>

      <img [src]="currentItem.imageUrl || 'assets/images/placeholder.jpg'" alt="Current item">

      <mat-card-content>
        <p class="item-description">{{ currentItem.description || 'No description available' }}</p>
        <div class="item-meta">
          <span><strong>Brand:</strong> {{ currentItem.brand }}</span>
          <span><strong>Size:</strong> {{ currentItem.size }}</span>
        </div>
      </mat-card-content>

      <div class="like-indicator" [style.opacity]="likeOpacity">LIKE</div>
      <div class="nope-indicator" [style.opacity]="nopeOpacity">NOPE</div>
    </mat-card>
  </div>

  <!-- Choice Feedback -->
  <div class="choice-feedback" *ngIf="lastInteractionDirection !== 0 && !loadingAI">
    <div class="ai-decision" [ngClass]="{'like': lastInteractionDirection > 0, 'dislike': lastInteractionDirection < 0}">
      <mat-icon>{{ lastInteractionDirection > 0 ? 'thumb_up' : 'thumb_down' }}</mat-icon>
    </div>
  </div>

  <!-- Controls -->
  <div class="swipe-controls" *ngIf="currentItem && !loadingAI">
    <button mat-fab color="warn" class="control-button" (click)="dismiss()">
      <mat-icon>close</mat-icon>
    </button>
    <button mat-fab color="primary" class="control-button" (click)="like()">
      <mat-icon>favorite</mat-icon>
    </button>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!currentItem && !loadingAI">
    <mat-icon class="empty-icon">search_off</mat-icon>
    <h2>No more items to show</h2>
    <p>AI has reached the end of recommendations based on your preferences</p>
    <button mat-raised-button color="primary" (click)="closed.emit()">
      <mat-icon>arrow_back</mat-icon> Back to Dashboard
    </button>
  </div>
</div>
