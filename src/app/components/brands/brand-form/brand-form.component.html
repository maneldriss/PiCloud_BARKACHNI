<div class="container">
    <h2>{{ isEditMode ? 'Edit' : 'Add' }} Brand</h2>
    
    <div *ngIf="loading" class="text-center">
      <div *ngIf="uploadProgress !== null" class="mb-2">
        <div class="progress">
          <div class="progress-bar" [style.width.%]="uploadProgress" role="progressbar">
            {{ uploadProgress }}%
          </div>
        </div>
        <small>Uploading logo...</small>
      </div>
      <div *ngIf="uploadProgress === null" class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    
    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>
    
    <form [formGroup]="brandForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
      <!-- Name Field -->
      <div class="mb-3">
        <label for="name" class="form-label">Brand Name*</label>
        <input type="text" class="form-control" id="name" formControlName="name">
        <div *ngIf="nameControl?.invalid && (nameControl?.dirty || nameControl?.touched)" class="text-danger">
          Brand name is required.
        </div>
      </div>
      
      <!-- Logo Field -->
      <div class="mb-3">
        <label class="form-label">Brand Logo</label>
        
        <div class="btn-group btn-group-sm mb-2" role="group">
          <button type="button" class="btn" 
                  [class.btn-primary]="logoInputMethod === 'url'"
                  [class.btn-outline-primary]="logoInputMethod !== 'url'"
                  (click)="switchInputMethod('url')">
            Use URL
          </button>
          <button type="button" class="btn"
                  [class.btn-primary]="logoInputMethod === 'upload'"
                  [class.btn-outline-primary]="logoInputMethod !== 'upload'"
                  (click)="switchInputMethod('upload')">
            Upload Image
          </button>
        </div>
        
        <!-- URL Input -->
        <div *ngIf="logoInputMethod === 'url'" class="mb-2">
          <input type="url" class="form-control" formControlName="logo" 
                 placeholder="https://example.com/logo.png">
          <div *ngIf="logoControl?.invalid && (logoControl?.dirty || logoControl?.touched)" class="text-danger">
            Please enter a valid image URL (jpg, png, gif, svg, webp)
          </div>
        </div>
        
        <!-- File Upload -->
        <div *ngIf="logoInputMethod === 'upload'" class="mb-2">
          <input type="file" class="form-control" id="logoUpload" 
                 (change)="onFileSelected($event)" accept="image/*">
        </div>
        
        <!-- Logo Preview -->
        <div *ngIf="previewUrl" class="mt-2">
          <img [src]="previewUrl" alt="Logo preview" class="img-thumbnail" style="max-height: 100px;">
          <button type="button" class="btn btn-sm btn-danger ms-2" (click)="removeLogo()">
            Remove Logo
          </button>
        </div>
        
        <small class="text-muted">
          {{ logoInputMethod === 'url' ? 
             'Enter full image URL (must start with http/https)' : 
             'Upload JPG, PNG, GIF, WEBP or SVG (max 2MB)' }}
        </small>
      </div>
      
      <!-- Description Field -->
      <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" rows="3" formControlName="description"></textarea>
      </div>
      
      <!-- Rating Field -->
      <div class="mb-3">
        <label for="rating" class="form-label">Rating (0-5)</label>
        <input type="number" class="form-control" id="rating" formControlName="rating" min="0" max="5" step="0.1">
        <div *ngIf="ratingControl?.invalid && (ratingControl?.dirty || ratingControl?.touched)" class="text-danger">
          Rating must be between 0 and 5.
        </div>
      </div>
      
      <!-- Address Field -->
      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input type="text" class="form-control" id="address" formControlName="address">
      </div>
      
      <!-- Email Field -->
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" formControlName="email">
        <div *ngIf="emailControl?.invalid && (emailControl?.dirty || emailControl?.touched)" class="text-danger">
          Please enter a valid email address.
        </div>
      </div>
      
      <div class="d-flex justify-content-between mt-4">
        <button type="submit" class="btn btn-primary" [disabled]="brandForm.invalid">
          {{ isEditMode ? 'Update' : 'Create' }} Brand
        </button>
        <a routerLink="/brands" class="btn btn-outline-secondary">
          Cancel
        </a>
      </div>
    </form>
  </div>