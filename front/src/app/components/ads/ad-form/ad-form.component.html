<div class="container">
  <h2>{{ isEditMode ? 'Edit' : 'Add' }} Advertisement</h2>
  
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading...</p>
  </div>
  
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>
  
  <form [formGroup]="adForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <!-- Title Field -->
    <div class="mb-3">
      <label for="title" class="form-label">Title*</label>
      <input type="text" class="form-control" id="title" formControlName="title">
      <div *ngIf="titleControl?.invalid && (titleControl?.dirty || titleControl?.touched)" class="text-danger">
        <div *ngIf="titleControl?.errors?.['required']">Title is required.</div>
      </div>
    </div>
    
    <!-- Description Field -->
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea class="form-control" id="description" rows="3" formControlName="description"></textarea>
    </div>
    
    <!-- Image Field -->
    <div class="mb-3">
      <label class="form-label">Advertisement Image</label>
      
      <!-- Toggle between URL and File Upload -->
      <div class="btn-group btn-group-sm mb-2">
        <button type="button" 
                class="btn" 
                [class.btn-primary]="imageInputMethod === 'url'"
                [class.btn-outline-primary]="imageInputMethod !== 'url'"
                (click)="switchInputMethod('url')">
          Use Image URL
        </button>
        <button type="button" 
                class="btn"
                [class.btn-primary]="imageInputMethod === 'upload'"
                [class.btn-outline-primary]="imageInputMethod !== 'upload'"
                (click)="switchInputMethod('upload')">
          Upload Image
        </button>
      </div>
    
      <!-- URL Input -->
      <div *ngIf="imageInputMethod === 'url'" class="mb-2">
        <input type="url" 
               class="form-control" 
               placeholder="https://example.com/image.jpg"
               formControlName="image">
        <div *ngIf="imageControl?.invalid && (imageControl?.dirty || imageControl?.touched)" 
             class="text-danger">
          Please enter a valid image URL (jpg, png, gif, svg, webp)
        </div>
      </div>
    
      <!-- File Upload -->
      <div *ngIf="imageInputMethod === 'upload'" class="mb-2">
        <input type="file" 
               class="form-control" 
               id="adImageUpload"
               (change)="onFileSelected($event)" 
               accept="image/*">
        <div class="form-text">Max file size: 2MB (JPG, PNG, GIF, SVG, WEBP)</div>
      </div>
    
      <!-- Image Preview -->
      <div *ngIf="previewUrl" class="mt-2">
        <img [src]="previewUrl" 
             alt="Preview" 
             class="img-thumbnail" 
             style="max-height: 200px;">
        <button type="button" 
                class="btn btn-sm btn-danger ms-2" 
                (click)="removeImage()">
          Remove Image
        </button>
      </div>
    </div>
    
    <!-- Link Field -->
    <div class="mb-3">
      <label for="link" class="form-label">Link*</label>
      <input type="url" class="form-control" id="link" formControlName="link">
      <div *ngIf="linkControl?.invalid && (linkControl?.dirty || linkControl?.touched)" class="text-danger">
        <div *ngIf="linkControl?.errors?.['required']">Link is required.</div>
      </div>
    </div>
    
    <!-- Expiration Date Field -->
    <div class="mb-3">
      <label for="expDate" class="form-label">Expiration Date*</label>
      <input type="date" class="form-control" id="expDate" formControlName="expDate">
      <div *ngIf="expDateControl?.invalid && (expDateControl?.dirty || expDateControl?.touched)" class="text-danger">
        <div *ngIf="expDateControl?.errors?.['required']">Expiration date is required.</div>
      </div>
    </div>
    
    <!-- Brand Selection -->
    <div class="mb-3">
      <label for="brand" class="form-label">Brand*</label>
      <select class="form-select" id="brand" formControlName="brand">
        <option value="">Select a brand</option>
        <option *ngFor="let brand of brands" [value]="brand.id">{{ brand.name }}</option>
      </select>
      <div *ngIf="brandControl?.invalid && (brandControl?.dirty || brandControl?.touched)" class="text-danger">
        <div *ngIf="brandControl?.errors?.['required']">Brand selection is required.</div>
      </div>
    </div>
    
    <div class="d-flex justify-content-between mt-4">
      <button type="submit" class="btn btn-primary" [disabled]="adForm.invalid">
        {{ isEditMode ? 'Update' : 'Create' }} Advertisement
      </button>
      <a routerLink="/ads" class="btn btn-outline-secondary">
        Cancel
      </a>
    </div>
  </form>
</div>